# 性能验证口径（NFR2 / NFR3）— 可回归对比

> 目标：在进入 Epic 5（可视化与实时反馈）之前，先把 **指标定义 + 采集入口 + 记录方式** 固化，避免后续“看起来很快/很卡但没有统一口径”。

## NFR2：流式输出首字节延迟（< 500ms）

### 指标定义（统一口径）

- `firstMessageLatencyMs`：从“发起一次运行/开始推送”到“前端收到第一条 WS 消息（任意类型）”的耗时（ms）
- 注意：**不包含老师模型推理耗时的口径差异**在此阶段先不纠结，NFR2 关注“可视化链路首条可见反馈”的端到端感知延迟。

### 本地采集入口（纯本地、不出网）

- 前端页面：`/ __perf__ /nfr2`（实际路径：`/__perf__/nfr2`）
- 代码：`frontend/src/pages/PerfNfr2View.tsx`
- 当前阶段用 `frontend/src/features/ws-demo/demoWsMessages.ts` 的确定性消息流模拟“首条 WS 消息到达”口径，先把采集入口固定。

### 记录方式（可回归对比）

每次准备合并/发版前，记录：
- 环境信息（OS/浏览器版本/是否 CI）
- `firstMessageLatencyMs` 的多次采样（至少 5 次）与中位数（median）

> 说明：由于不同机器/浏览器抖动明显，本阶段**不建议**把该阈值硬编码成 CI 门禁；但口径必须固定，方便对比回归趋势。

## NFR3：节点图渲染性能（60fps）

### 指标定义（统一口径）

- `fps`：在固定时长窗口（建议 1000ms）内的 `requestAnimationFrame` 帧数 / 秒
- 关注点：掉帧/卡顿（frame drop）是否明显；60fps 为目标

### 本地采集入口（纯本地、不出网）

- 前端页面：`/__perf__/nfr3`
- 代码：`frontend/src/pages/PerfNfr3View.tsx`
- 当前阶段使用“固定数量 DOM 元素 + rAF 计数”作为占位基准；Epic 5 接入真实节点图（React Flow）后，替换为“真实节点图渲染 + 动画”场景但保持指标口径不变。

### 记录方式（可回归对比）

每次准备合并/发版前，记录：
- `fps` 的多次采样（至少 5 次）与中位数（median）
- 如果出现明显回退，保留当次采样数据与对应 commit（用于定位）

