# Epic 3 复盘（Retrospective）

- 项目：Prompt Faster（prompt-faster）
- Epic：Epic 3「优化任务配置与工作区」
- 日期：2026-01-15
- 复盘方式：无责复盘（聚焦系统/流程/学习）

## 参与角色（Party Mode）

- Bob (Scrum Master)
- Alice (Product Owner)
- Winston (Architect)
- Charlie (Senior Dev)
- Dana (QA Engineer)
- Elena (Junior Dev)
- 耶稣 (Project Lead)

## Epic 3 概览（基于 `docs/implementation-artifacts/sprint-status.yaml`）

- 完成情况：7/7 stories 已标记 `done`（3.1 ~ 3.7）
- Retro 状态：本文件用于标记 Epic 3 复盘完成
- Epic 3 目标：把“可运行的优化算法核心”之前的配置与数据隔离能力打牢（任务配置 + 工作区隔离 + 多老师模型切换），为后续 Epic 4（自动迭代执行）提供稳定输入面与边界。

## 做得好的（Successes）

1) **配置能力闭环 + 边界更清晰**
   - 任务创建/基础配置（3.1）与初始 Prompt/终止条件（3.2）把“可开始优化”的最低输入面固定下来。
   - 核心算法参数与默认配置（3.4）明确“默认值可验证 + 一键回滚”，避免用户把系统调到不可恢复状态。

2) **向后兼容意识更强（为后续扩展留余地）**
   - 多处对 `config_json` 的“大小上限/脱敏/保留未知字段（extra）”做了约束与回归防护，降低未来新增字段导致的破坏性变更风险。

3) **工作区隔离为后续 Epic 放大复杂度提供了安全网**
   - 工作区创建/切换/删除与数据隔离（3.5/3.6）让“同一用户多个实验”成为产品一等能力，为后续迭代历史、断点续跑等提供基础边界。

4) **多老师模型切换落地且保持 MVP 克制**
   - 3.7 把“可配置/可切换”落地，同时避免过早引入强一致性校验（例如强制 `/v1/models` 实时校验），保持可用优先。

## 挑战与痛点（Challenges）

1) **配置结构易膨胀且容易泄露敏感信息**
   - `config_json` 天生会承载更多字段，若不限制大小/不做脱敏，后续日志与错误链路将成为隐患。

2) **“extra 字段保留”的回归测试非常关键**
   - 一旦端点在更新时覆盖未知字段，会造成“升级后悄悄丢配置”的隐性风险；该问题往往不是立即暴露，而是后续功能引入时才爆炸。

3) **生成类型（gen-types）与前端类型一致性需要持续门禁**
   - 类型生成链路一旦漏提交/漏更新，会导致同事环境与 CI 出现“同仓库不同构建结果”的不稳定。

4) **工作区相关路由/导航规则存在未来漂移风险**
   - 随着 workspace-scoped 路由增多，若导航目标路径规则不集中，会出现“切换后落点不一致”的体验问题。

## 关键洞察（Key Insights）

- **配置的“向后兼容”不是锦上添花，是后续 Epic（4/5/6/7）能持续迭代的前提。**
- **工作区隔离的价值会随着功能增长而指数放大；越早把边界写死，后续越不痛。**
- **类型生成链路是跨端契约的一部分，应被当作门禁，而不是开发者“记得就好”。**

## Significant Discovery（是否需要更新后续 Epic 计划？）

- 结论：不需要对 Epic 4 的功能范围做根本性调整。
- 需要保持的约束：继续坚持“配置大小上限 + 脱敏 + extra 保留 + 类型生成一致性门禁”，否则后续 Epic 会放大一致性与安全风险。

## 就绪性核对（Readiness Check）

- Testing & Quality：可进入下一 Epic（前提是继续坚持回归门禁与契约单一事实来源）
- Codebase Health：良好（但配置膨胀与类型生成链路必须持续被门禁约束）
- Unresolved Blockers：无硬阻塞

## 行动项（Action Items）

> 原则：具体、可验收、带 Owner；避免口号与工期预估。

1) 将“类型生成一致性（gen-types）”固定为团队默认流程并保持可回归  
   - Owner：Winston (Architect) + Dana (QA Engineer)  
   - Success：任意跨端契约变更后，类型生成产物可追溯、可复跑、且 CI 能发现遗漏

2) 持续锁死配置写入的向后兼容行为（extra 保留 + 大小上限 + 脱敏）  
   - Owner：Charlie (Senior Dev)  
   - Success：新增字段不会导致旧字段丢失；日志/错误链路不泄露敏感配置原文

3) 抽取并统一 workspace 切换落点规则，避免未来导航漂移  
   - Owner：Sally (UX Designer) + Amelia (Dev Agent)  
   - Success：workspace-scoped 路由扩展时只改动单一入口点并有回归验证

## 结语（Closure）

Bob (Scrum Master): “Epic 3 把‘可配置 + 可隔离 + 可扩展’的输入面打稳了。下一步（Epic 4/后续）能更专注在算法与执行闭环，而不是被配置与边界反复拖回去修。”

