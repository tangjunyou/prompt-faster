# Epic 1 复盘（Retrospective）

- 项目：Prompt Faster（prompt-faster）
- Epic：Epic 1「系统基础与 API 连接」
- 日期：2026-01-03
- 复盘方式：无责复盘（聚焦系统/流程/学习）

## 参与角色（Party Mode）

- Bob (Scrum Master)
- Alice (Product Owner)
- Winston (Architect)
- Charlie (Senior Dev)
- Dana (QA Engineer)
- Elena (Junior Dev)
- 耶稣 (Project Lead)

## Epic 1 概览（基于 `docs/implementation-artifacts/sprint-status.yaml`）

- 完成情况：10/10 stories 已标记 `done`（1.1 ~ 1.10）
- Epic 状态：`in-progress`（故事层面已完成；Epic 状态是否上调为 `done` 需按项目约定另行处理）
- Retro 状态：已完成（本文件 + `sprint-status.yaml` 已更新）

## 做得好的（Successes）

1) **地基能力交付完整且可复用**
   - 本地登录与会话（Story 1.6）
   - 用户数据隔离与访问控制（Story 1.7）
   - 统一错误响应与 OpenAPI 文档化方向（Story 1.8）
   - 前端架构与类型安全 API Client 规范（Story 1.9）

2) **一致性 Guardrails 有效抑制实现发散**
   - 依赖版本/目录结构/错误结构/路由与 API 约定更清晰，降低“第二套实现”风险（多 story 的 Dev Notes 均强调单一事实来源与禁止重复）

3) **CI 与测试门禁建立了可持续的质量底座**
   - CI 覆盖 lint/test/build/E2E（Story 1.10）
   - “核心旅程覆盖”门禁让回归更具确定性（Story 1.10）

## 挑战与痛点（Challenges）

我们确认 **1/2/3 都重要**，且相互耦合：

1) **技术债/遗留 TODO 有集中点**（主要在 1.5/1.6/1.7）
   - 与凭证安全、加密/脱敏实现风险、遗留常量/迁移标记等相关的 TODO 值得在进入“数据密集型 Epic”前收敛。

2) **CI/构建“门禁有效但易被小洞卡住”**
   - 例如出现过前端 TS build 被测试文件/类型声明等细节阻塞的情况（Story 1.10 记录）。

3) **Review 反馈“存在但沉淀方式不统一”**
   - 有的 story 有详细 code review 轮次与结论（如 1.5），有的较分散或缺乏统一结构，导致难以跨 story 提炼“反复出现的问题类别”和“团队承诺”。

## 关键决策（Key Decision）

- 进入 Epic 2（测试集管理）的策略：**B（先补最痛的洞）**
- 启动方式：**A（先完成 Critical Prep，再开始 Epic 2）**

## Epic 2（测试集管理）启动前的 Critical Prep（阻塞项）

> 目标：在“数据模型 + CRUD + 导入”开始前，先把会被放大的风险收敛掉。

1) **收敛安全/隔离相关遗留项（优先级最高）**
   - Owner：Charlie (Senior Dev)
   - Review：Winston (Architect)
   - Done 标准（可验收）：关键风险点要么消除，要么形成明确的技术决策与替代方案，并在代码/文档中可追溯。

2) **CI 门禁稳定性补强（减少反复卡点）**
   - Owner：Dana (QA Engineer) + Charlie (Senior Dev)
   - Done 标准（可验收）：本地有清晰可重复的预检清单；CI 路径稳定、避免同类“细节阻塞”反复出现。

3) **最小化 Review 沉淀机制落地（持续可执行，不上强流程）**
   - Owner：Bob (Scrum Master)
   - Confirm：耶稣 (Project Lead)
   - Done 标准（可验收）：后续每个 story 至少包含统一结构的 Review Notes（问题分类、修复/不修复理由、Follow-ups、风险与遗留）。

### Critical Prep 执行记录（已完成）

- 安全/隔离：`backend/src/infra/external/api_key_manager.rs`、`backend/src/api/routes/auth.rs`、`backend/src/main.rs`
- 测试更新：`backend/tests/*`
- Story/Review 机制：`_bmad/bmm/workflows/4-implementation/create-story/template.md`、`_bmad/bmm/workflows/4-implementation/code-review/instructions.xml`
- 门禁自检：后端 `cargo fmt`/`cargo clippy -- -D warnings`/`cargo test --all`；前端 `npm run lint`/`npx tsc --noEmit`/`npm run test -- --run`/`npm run build`；并通过 Docker Compose 健康检查

## 可并行准备（Parallel Prep，不阻塞但建议尽早）

1) **明确 Epic 2 的“边界清单”**
   - Owner：Alice (Product Owner) + Winston (Architect)
   - 输出：测试集数据模型边界、导入格式约束、workspace/user 归属规则、错误码与返回结构约定。

2) **按依赖关系微调 Epic 2 stories 顺序**
   - Owner：Bob (Scrum Master) + 耶稣 (Project Lead)
   - 原则：先做低不确定性的基础 CRUD/模板，再做 Dify 变量解析与“待优化变量指定”等高不确定性项。

## 关键洞察（Key Insights）

- **“质量门禁”只有在“门禁本身稳定”时才会被团队持续使用。**
- **进入数据密集/导入链路前，安全与隔离风险的 TODO 会被快速放大。**
- **Review 沉淀的价值在“可检索、可复用、可追责（不是责人，而是责改进）”。**

## Significant Discovery（是否需要更新 Epic 2 计划？）

- 结论：**不需要对 Epic 2 的功能范围做根本性调整**；但需要将本复盘的 **Critical Prep** 作为 Epic 2 启动前的关键路径约束。

## 就绪性核对（Readiness Check）

- Testing & Quality：**充分（针对当前本地运行/CI 约束）**；进入 Epic 2 前重点是“安全/隔离风险收敛 + 门禁稳定性补强”。
- Deployment：**仅本地 Docker Compose 运行形态**（当前未进行生产化部署语境下的验收）。
- Stakeholder Acceptance：**以项目自验为主**（未记录外部相关方验收门槛）。
- Codebase Health：**整体稳，但在凭证安全/脱敏等遗留 TODO 收敛前偏“有点脆”**。
- Unresolved Blockers：**无明确硬阻塞**；但 **Critical Prep 未完成前不启动 Epic 2**。

### 凭证数据迁移提醒（重要）

- 如果你在本次变更前已经保存过凭证数据：旧数据可能仍依赖当时的 `MASTER_PASSWORD` 进行解密。
- 建议操作：临时设置旧的 `MASTER_PASSWORD` 启动后端 → 登录 → 打开配置页“重新保存配置”（触发用登录密码重新加密）→ 之后即可移除 `MASTER_PASSWORD` 依赖。

## 行动项（Action Items）

> 原则：具体、可验收、带 Owner；避免模糊口号。

### 技术类

1) 收敛“凭证安全/脱敏/隔离边界”相关 TODO 到可验收状态  
   - Owner：Charlie (Senior Dev)  
   - Success：关键风险点关闭或有明确技术决策与可追溯记录

2) 将“CI 反复卡点”固化为本地预检清单与稳定路径  
   - Owner：Dana (QA Engineer)  
   - Success：同类问题不再反复出现；新贡献者按清单可自检

### 流程/文档类

3) 定义并推广最小 Review Notes 结构（用于所有新 story）  
   - Owner：Bob (Scrum Master)  
   - Success：每个 story 的 review 结论、遗留项、风险可快速检索与复用

4) 为 Epic 2 输出“边界清单”（数据模型/导入/归属/错误约定）  
   - Owner：Alice (Product Owner) + Winston (Architect)  
   - Success：实现前不再因边界不清导致反复返工

## 结语（Closure）

Bob (Scrum Master): “今天我们做得很好：既肯定成果，也直面风险，并且形成了‘先补洞再开工’的清晰决策。下一步按 Critical Prep 逐项验收后，再启动 Epic 2。”
